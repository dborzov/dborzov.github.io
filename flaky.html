<!DOCTYPE html>

<html>

  <head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta charset="utf-8">



    <title>dimaborzov.com/texts/flaky (Flaky: datatypes for real world quantities)</title>

    <link rel="stylesheet" href="./css/style.css" type="text/css">

    <link rel="stylesheet" href="./css/_pygments.css" type="text/css">

      <style type="text/css"></style>

      <script type="text/javascript" src="http://latex.codecogs.com/latexit.js"></script>

  </head>

  <body screen_capture_injected="true">

    <div class="container">

      <div class="header">

        <a href="http://dimaborzov.com">Dima Borzov</a>'s code and writings<br>

        <a href="http://dimaborzov.com">dimaborzov.com</a> / texts / flaky



      </div>

      <div class="navigation">

        <ul>

          <li><a href="https://github.com/dborzov"><img src="./css/octocat.png" width="20">Github</a>

        </li></ul>

      </div>



      <div class="body">
<h1>Flaky: datatypes for real world quantities</h1>

<h3><em>Abstract:</em> Modern datatypes for quantities (such as length, time, a number) should employ ideas from functional programming: keep track when the rounding errors arise,  support defining with functions, represent results appropriately to the context. Flaky, an open source framework, wants to make things right.</h3>

<p><a href="https://en.wikipedia.org/wiki/Floating_point">Floating point datatype</a> is the de-facto standard for real world quantities. Whether it is a banking account or sizes of the bridge nearby (designed in AutoCAD), this datatype lies in the foundation of every system. Since its introduction in the dawn of computing, floating point was accepted almost universally.</p>

<p>Advantages such as scalability, resilence and ease of use make floating point the datatype of choice again and again. However, it is also fragile and prone to errors. This limitations are well known, of course, and could be minimized with appropriate  expertise and focus.</p>

<p>And yet I believe that we, as an industry, could do better. Number respresentation based on functional programming paradigm minimizes flaws manifest to the floating point datatypes. And it could be made as resilient and scalable as the floating point. In this article, I outline why, I decided to write Flaky, an open source library that implements these ideas.</p>

<p>In the first section here we will glance at illustrating cases of when floating point breaks and try to undestand what flaws should be addressed. We then look at other initiatives in this space. Finally, I introduce the design I came up with for Flaky.</p>

<h2>When floating point fails</h2>

<p>Let us consider illustrative cases of when floating point representation leads to dramatically wrong answers.</p>

<h4>Accumulating errors</h4>

<p>Well, this one is obvious. When the number cannot be represented exactly, it has to be rounded up. These rounding errors can accumulate and can lead to silly results.</p>

<p>Let us, for example, take the square root of a number several times, and then try to reproduce the original value with reversal operations by taking squares.</p>

<pre><code> 
# price.py listing, a Python script
import math
INITIAL_VALUE=1.9934545345

def reversable_iterations(iteration_number):
    test_floating = INITIAL_VALUE
    for i in range(iteration_number):
        test_floating = math.sqrt(test_floating)
    for i in range(iteration_number):
        test_floating = test_floating**2
    return 'with '+str(iteration_number)+' iterations, we get '+str(test_floating)

print 'The intial value is ',INITIAL_VALUE
print reversable_iterations(1)
print reversable_iterations(10)
print reversable_iterations(20)
print reversable_iterations(40)
print reversable_iterations(50)
print reversable_iterations(60)
</code></pre>

<p>This yields:</p>

<pre><code> 
The intial value is  1.9934545345
with 1 iterations, we get 1.9934545345
with 10 iterations, we get 1.9934545345
with 20 iterations, we get 1.99345453444
with 40 iterations, we get 1.99311204568
with 50 iterations, we get 1.64872126455
with 60 iterations, we get 1.0
</code></pre>

<p>That the end result breaks is hardly a suprise. Morover, a similar effect could be achieved for any number respresentation datatype. Just from the general principles, if the size  of the <a href="http://en.wikipedia.org/wiki/Kolmogorov_complexity">Kolmogorov complexity</a> of a number is larger than the memory allocated for the datatype, these types of errors cannot be ruled out.</p>

<p>What I wanted to emphasize here instead is the total equanimity of the floating type. It is very hard to understand what is going on at various stages. In my opinion, it is an incredible engineering design flaw.</p>

<p>To see what I mean, let us figure out why the error is of order of 10% for 50 iterations, but converges to a wrong answer at 60. To do this we have to know how the number is represented internally, look up the default  <a href="https://en.wikipedia.org/wiki/Significand">mantissa/significand</a> size for the programming language of our choice and make the estimation calculation on a piece of paper. Seriously. In 2013.</p>

<h4>A square equation</h4>

<p>Let us take the following quadratic equation:
    <center><div lang="latex"> 10^{-19} x^2 + 15 x = 0 </div></center><br>
And solve it using the library of your choice. Here is the first Google result for quadratic equation solver:</p>

<p><center><div lang="latex">
<img src="http://dimaborzov.com/img/QuadraticEquation.png" alt="Img" />
</div></center><br></p>

<p>Yet this is not the feature of a , but a sign of the general deep-rooted problem.</p>

<p><a href="http://what-if.xkcd.com/11/">Obligatory xkcd</a></p>

<h4>Logarithms.</h4>

<p>Things could go very bad very quickly with non-analitical terms in the expansion. Let us assume we study function the leading term for which looks as one of this options:
    <center><div lang="latex"> f(x) =\textrm{Log} \Large( Log(\frac{1}{x}) \Large) + x </div></center><br>
    <center><div lang="latex"> f(x) = Log \Large( \frac{1}{x} \Large) + x </div></center><br></p>

<p>This is an actual problem I encountered, when we were working on the research study on 2D.</p>

<h4>Summary.</h4>

<p>Another feature, that is, in my opinion, completely undervaluated is how. It is very hard to trace when the rounding of error happens with floating point datatypes. It is a well known design concept that .</p>

<p>For the better number datatype, every operation performed with the number should be tracable. Errors and uncertainties also should be traced from each operation and reported when needed.</p>

<h2>Doing things right</h2>

<p>This issues are well known and of course are . Not only errors go unreported but it is</p>

<h4>What is out there.</h4>

<h4>Why not flaky.</h4>

<blockquote>
  <p>An infinite number of mathematicians walk into a bar. The first orders a beer. The second orders half a beer. The third orders a quarter of a beer. Before the next one can order, the bartender says, Youre all assholes, and pours two beers.
  <a href="http://www.komplexify.com/math/jokes/MathWalksIntoABar3.html">TE</a></p>
</blockquote>

<p>So we saw that how to make things better than going floating points and why we should. These reasons compeled me start Flaky, an open-source project project, with following features:</p>

<p>Flaky is written in Go.</p>

<p>The easiest way to play is at the FlakyPastry website: a sandbox for playing with FlakyQuantities.
Please join me and to contribute to</p>

      </div>

      <div class="footer">

        <p><a href="http://creativecommons.org/licenses/by-nc-sa/2.5/ca/"><img src="./css/cc.jpg" width="15"></a> Dmitry Borzov, 2013.

        </p>

      </div>

    </div>







</div></body>



<script>

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){

  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),

  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)

  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');



  ga('create', 'UA-41000570-1', 'dimaborzov.com');

  ga('send', 'pageview');



</script>



</html>
